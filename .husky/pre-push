#!/usr/bin/env sh

BRANCH=$(git rev-parse --abbrev-ref HEAD)

# EXEC-блок только для main
if [ "$BRANCH" = "main" ]; then
  echo "You are about to push changes from aiflowlabs-exec (Exec domain frontend)."
  printf "Type EXEC to confirm push: "

  ANSWER=""

  if [ -t 0 ]; then
    # stdin — терминал
    read -r ANSWER
  elif [ -r /dev/tty ]; then
    # читаем напрямую из терминала
    read -r ANSWER < /dev/tty
  else
    echo "Cannot access terminal for confirmation. Aborting push."
    exit 1
  fi

  if [ "$ANSWER" != "EXEC" ]; then
    echo "Push aborted by pre-push hook."
    exit 1
  fi
fi

# Лёгкие проверки перед любым пушем
npm run prepush
